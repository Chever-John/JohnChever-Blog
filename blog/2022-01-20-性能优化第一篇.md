---
slug: 性能优化第一篇
title: 性能优化第一篇
authors: CheverJohn
tags: [OpenResty_GeekBang_Courses, OpenResty]
---
# 对 OpenResty 性能优化的浅尝

> 文章来自于对极客空间《OpenResty 从入门到实战》课程的学习汇总。

## 阻塞函数

### 一个重要原则——避免使用阻塞函数

OpenResty 的高性能的由来，主要是因为 “使用” 了 NGINX 的事件处理和 Lua 的协程机制。如果我 们使用阻塞函数的话，就意味着会有阻塞这一 ”使用“ 的可能性。这就会导致请求无法正常交由 NGINX 和 Lua 进行处理。

### 在调用外部命令时需要注意的事情

Lua 使用 `os.execute`函数调用外部命令，如果调用时间需要几百毫秒~几秒钟，那么我们会遇到阻塞，性能会下降！

同样是会有遇到阻塞情况的可能性，我们需要想办法避免阻塞。原课程中，主讲人提出几个实际的场景例子：拷贝文件、使用 OpenSSL 生成密钥等耗时久的操作。针对这些场景，提出了两个具体的方案 **FFI 库调用**、ngx.pipe 的 **lua-resty-shell 库的使用**。

当然本质上还是没有离开主题——“**避免使用阻塞函数**”

### 磁盘 I/O

个人理解，磁盘读写向来都是最损耗性能的，我们首先应该要做的就是减少 I/O 读写。

这边我学习到的是，可以通过使用 `lua-io-nginx-module` 这个第三方的 C 模块提高性能。原理是将 I/O 操作从主线程转移到另外一个线程中处理

## 字符串

## Table

## 调优手段

## 定位性能瓶颈

### wrk 和火焰图

## 缓存

### shared dict 缓存和 lru 缓存

### 缓存风暴

### 解决：lua--resty-* 封装

## 突发流量

### 漏桶和令牌桶

### 动态限流限速

### 动态

## OpenResty 常用的第三方库

